---
title: "Homework #3"
author: "Natalie Mayer"
format: html
editor: visual
---

```{r}
library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(stringr)

ca_rights <- read_csv(here("data", "california.csv"))

```


```{r}
water_use_pal <- c("Domestic" = "red", 
                   "Environment" = "lightblue", 
                   "Industrial" = "gray2", 
                   "Agriculture" = "tan2")

desired_order <- c("Industrial",
                   "Domestic", 
                   "Agriculture", 
                   "Environment")

ca_rights_use <- ca_rights %>%
  clean_names() %>%
  select(priority_date, cfs, water_use) %>%
  mutate(date = mdy(priority_date)) %>%
  mutate(date = if_else(year(date) > 2023, date - years(100), date)) %>%
  mutate(year = year(date))%>%
  filter(year > 1929) %>%
  filter(year < 2000) %>%
  mutate(decade = case_when(
    year %in% (1930:1939) ~ "1930s", 
    year %in% c(1940:1949) ~ "1940s", 
    year %in% (1950:1959) ~ "1950s", 
    year %in% c(1960:1969) ~ "1960s",
    year %in% (1970:1979) ~ "1970s", 
    year %in% c(1980:1989) ~ "1980s",
    year %in% c(1990:1999) ~ "1990s"
  )) %>%
  select(decade, cfs, water_use) %>%
  group_by(decade, water_use) %>%
  summarise(cfs = sum(cfs)) %>%
  ungroup() %>%
  filter(water_use != "other") %>%
  mutate(water_use = case_when(
    water_use %in% c("livestock", "irrigation") ~ "Agriculture",
    water_use %in% c("environmental", "fish") ~ "Environment",
    water_use == "industrial" ~ "Industrial",
    water_use == "domestic" ~ "Domestic")) %>%
  drop_na() %>%
  group_by(decade) %>%
  arrange(decade, desc(cfs)) %>%
  mutate(water_use = factor(water_use, levels = unique(water_use))) %>%
  ungroup()


ggplot(data = ca_rights_use, 
       aes(x = decade, y = cfs, fill = water_use)) + 
  geom_col(position = "dodge") + 
  scale_fill_manual(values = water_use_pal) + 
  theme_minimal() + 
  labs(title = "Industrial uses are consistently appropriated the most water rights in California", 
       x = " ", 
       y = "Volume of Water Appropriated (CFS)", 
       fill = "Water Use") + 
  theme(
    legend.position = "bottom")

```



